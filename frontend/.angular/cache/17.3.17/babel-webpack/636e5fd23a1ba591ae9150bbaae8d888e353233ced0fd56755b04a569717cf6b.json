{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet ProfileComponent = class ProfileComponent {\n  constructor(userService, bookService, loanService, router) {\n    this.userService = userService;\n    this.bookService = bookService;\n    this.loanService = loanService;\n    this.router = router;\n    this.user = {};\n    this.editedUser = {};\n    this.editMode = false;\n    this.loading = true;\n    this.isSaving = false;\n    this.errorMessage = '';\n    this.successMessage = '';\n    // Stats per admin\n    this.totalUsers = 0;\n    this.totalBooks = 0;\n    this.totalLoans = 0;\n  }\n  ngOnInit() {\n    this.loadProfile();\n  }\n  loadProfile() {\n    this.userService.getProfile().subscribe(response => {\n      this.user = response.user || response;\n      this.editedUser = {\n        ...this.user\n      };\n      this.loading = false;\n    }, error => {\n      console.log('Error carregant perfil', error);\n      this.errorMessage = error.error.message || 'Error carregant el perfil';\n      this.loading = false;\n    });\n  }\n  toggleEditMode() {\n    this.editMode = !this.editMode;\n    if (!this.editMode) {\n      this.editedUser = {\n        ...this.user\n      };\n    }\n  }\n  saveProfile() {\n    if (!this.canSave()) {\n      this.errorMessage = 'El nom i email són obligatoris';\n      return;\n    }\n    this.isSaving = true;\n    this.errorMessage = '';\n    this.successMessage = '';\n    this.userService.updateProfile(this.editedUser).subscribe(response => {\n      this.isSaving = false;\n      this.user = {\n        ...this.editedUser\n      };\n      this.editMode = false;\n      this.successMessage = 'Perfil actualitzat correctament!';\n      setTimeout(() => {\n        this.successMessage = '';\n      }, 3000);\n    }, error => {\n      this.isSaving = false;\n      this.errorMessage = error.error.message || 'Error actualitzant el perfil';\n    });\n  }\n  canSave() {\n    return !!(this.editedUser.nom?.trim() && this.editedUser.email?.trim());\n  }\n  changePassword() {\n    const newPassword = prompt('Introdueix la nova contrasenya:');\n    if (!newPassword) return;\n    if (newPassword.length < 6) {\n      this.errorMessage = 'La contrasenya ha de tenir almenys 6 caràcters';\n      return;\n    }\n    this.errorMessage = '';\n    this.successMessage = '';\n    // Aquí hauries de cridar a un servei changePassword\n    // De moment, mostrem un missatge\n    this.successMessage = 'Contrasenya canviada correctament!';\n    setTimeout(() => {\n      this.successMessage = '';\n    }, 3000);\n  }\n  deleteAccount() {\n    const confirm = window.confirm('Estàs segur que vols eliminar el teu compte? Aquesta acció no es pot desfer.');\n    if (!confirm) return;\n    this.errorMessage = '';\n    this.successMessage = '';\n    // Aquí hauries de cridar a un servei deleteAccount\n    this.successMessage = 'Compte eliminat correctament';\n    setTimeout(() => {\n      localStorage.removeItem('token');\n      this.router.navigate(['/login']);\n    }, 2000);\n  }\n  goHome() {\n    this.router.navigate(['/home']);\n  }\n};\nProfileComponent = __decorate([Component({\n  selector: 'app-profile',\n  templateUrl: './profile.component.html',\n  styleUrls: ['./profile.component.css']\n})], ProfileComponent);\nexport { ProfileComponent };","map":{"version":3,"names":["Component","ProfileComponent","constructor","userService","bookService","loanService","router","user","editedUser","editMode","loading","isSaving","errorMessage","successMessage","totalUsers","totalBooks","totalLoans","ngOnInit","loadProfile","getProfile","subscribe","response","error","console","log","message","toggleEditMode","saveProfile","canSave","updateProfile","setTimeout","nom","trim","email","changePassword","newPassword","prompt","length","deleteAccount","confirm","window","localStorage","removeItem","navigate","goHome","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\efren\\OneDrive\\Escriptori\\Enginyeria de llocs web\\Pract2_Costas\\frontend\\src\\app\\components\\profile\\profile.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { UserService } from '@services/UserService';\r\nimport { BookService } from '@services/BookService';\r\nimport { LoanService } from '@services/LoanService';\r\n\r\n@Component({\r\n  selector: 'app-profile',\r\n  templateUrl: './profile.component.html',\r\n  styleUrls: ['./profile.component.css']\r\n})\r\nexport class ProfileComponent implements OnInit {\r\n  user: any = {};\r\n  editedUser: any = {};\r\n  editMode: boolean = false;\r\n  loading: boolean = true;\r\n  isSaving: boolean = false;\r\n  errorMessage: string = '';\r\n  successMessage: string = '';\r\n  \r\n  // Stats per admin\r\n  totalUsers: number = 0;\r\n  totalBooks: number = 0;\r\n  totalLoans: number = 0;\r\n\r\n  constructor(\r\n    private userService: UserService,\r\n    private bookService: BookService,\r\n    private loanService: LoanService,\r\n    private router: Router\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loadProfile();\r\n  }\r\n\r\n  loadProfile(): void {\r\n    this.userService.getProfile().subscribe(\r\n      (response: any) => {\r\n        this.user = response.user || response;\r\n        this.editedUser = { ...this.user };\r\n        this.loading = false;\r\n      },\r\n      (error: any) => {\r\n        console.log('Error carregant perfil', error);\r\n        this.errorMessage = error.error.message || 'Error carregant el perfil';\r\n        this.loading = false;\r\n      }\r\n    );\r\n  }\r\n\r\n  toggleEditMode(): void {\r\n    this.editMode = !this.editMode;\r\n    if (!this.editMode) {\r\n      this.editedUser = { ...this.user };\r\n    }\r\n  }\r\n\r\n  saveProfile(): void {\r\n    if (!this.canSave()) {\r\n      this.errorMessage = 'El nom i email són obligatoris';\r\n      return;\r\n    }\r\n\r\n    this.isSaving = true;\r\n    this.errorMessage = '';\r\n    this.successMessage = '';\r\n\r\n    this.userService.updateProfile(this.editedUser).subscribe(\r\n      (response: any) => {\r\n        this.isSaving = false;\r\n        this.user = { ...this.editedUser };\r\n        this.editMode = false;\r\n        this.successMessage = 'Perfil actualitzat correctament!';\r\n        setTimeout(() => {\r\n          this.successMessage = '';\r\n        }, 3000);\r\n      },\r\n      (error: any) => {\r\n        this.isSaving = false;\r\n        this.errorMessage = error.error.message || 'Error actualitzant el perfil';\r\n      }\r\n    );\r\n  }\r\n\r\n  canSave(): boolean {\r\n    return !!(this.editedUser.nom?.trim() && this.editedUser.email?.trim());\r\n  }\r\n\r\n  changePassword(): void {\r\n    const newPassword = prompt('Introdueix la nova contrasenya:');\r\n    if (!newPassword) return;\r\n\r\n    if (newPassword.length < 6) {\r\n      this.errorMessage = 'La contrasenya ha de tenir almenys 6 caràcters';\r\n      return;\r\n    }\r\n\r\n    this.errorMessage = '';\r\n    this.successMessage = '';\r\n\r\n    // Aquí hauries de cridar a un servei changePassword\r\n    // De moment, mostrem un missatge\r\n    this.successMessage = 'Contrasenya canviada correctament!';\r\n    setTimeout(() => {\r\n      this.successMessage = '';\r\n    }, 3000);\r\n  }\r\n\r\n  deleteAccount(): void {\r\n    const confirm = window.confirm(\r\n      'Estàs segur que vols eliminar el teu compte? Aquesta acció no es pot desfer.'\r\n    );\r\n    if (!confirm) return;\r\n\r\n    this.errorMessage = '';\r\n    this.successMessage = '';\r\n\r\n    // Aquí hauries de cridar a un servei deleteAccount\r\n    this.successMessage = 'Compte eliminat correctament';\r\n    setTimeout(() => {\r\n      localStorage.removeItem('token');\r\n      this.router.navigate(['/login']);\r\n    }, 2000);\r\n  }\r\n\r\n  goHome(): void {\r\n    this.router.navigate(['/home']);\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}