<div class="admin-container">
  <div class="admin-header">
    <div class="header-content">
      <button class="btn-back" (click)="goBack()">‚Üê Tornar</button>
      <h1>üìö Gesti√≥ de Llibres</h1>
      <button class="btn-add" (click)="openCreateModal()">+ Afegir Llibre</button>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="toast success">‚úì {{ successMessage }}</div>
  <div *ngIf="errorMessage && !showModal" class="toast error">‚úï {{ errorMessage }}</div>

  <div class="content">
    <!-- Search -->
    <div class="search-bar">
      <input type="text" [(ngModel)]="searchTerm" placeholder="üîç Cercar per t√≠tol, autor o ISBN...">
      <span class="count">{{ filteredBooks.length }} llibres</span>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Carregant llibres...</p>
    </div>

    <!-- Table -->
    <div *ngIf="!loading" class="table-container">
      <table>
        <thead>
          <tr>
            <th>T√≠tol</th>
            <th>Autor</th>
            <th>ISBN</th>
            <th>Categoria</th>
            <th>Any</th>
            <th>Disponibles</th>
            <th>Accions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of filteredBooks">
            <td class="title-cell">{{ book.titol }}</td>
            <td>{{ book.autor }}</td>
            <td class="isbn-cell">{{ book.isbn }}</td>
            <td><span class="category-badge">{{ book.categoria }}</span></td>
            <td>{{ book.any }}</td>
            <td>
              <span class="availability" [class.low]="book.quantitatDisponible < 2">
                {{ book.quantitatDisponible }}/{{ book.quantitatTotal }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="btn-edit" (click)="openEditModal(book)">‚úèÔ∏è</button>
              <button class="btn-delete" (click)="deleteBook(book)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="filteredBooks.length === 0" class="no-results">
        No s'han trobat llibres
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingBook ? '‚úèÔ∏è Editar Llibre' : '‚ûï Nou Llibre' }}</h2>
        <button class="btn-close" (click)="closeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div *ngIf="errorMessage" class="modal-error">{{ errorMessage }}</div>
        
        <div class="form-row">
          <div class="form-group">
            <label>T√≠tol *</label>
            <input type="text" [(ngModel)]="bookForm.titol" placeholder="T√≠tol del llibre">
          </div>
          <div class="form-group">
            <label>Autor *</label>
            <input type="text" [(ngModel)]="bookForm.autor" placeholder="Autor del llibre">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ISBN</label>
            <input type="text" [(ngModel)]="bookForm.isbn" placeholder="ISBN">
          </div>
          <div class="form-group">
            <label>Categoria</label>
            <select [(ngModel)]="bookForm.categoria">
              <option value="">Selecciona categoria</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Any</label>
            <input type="number" [(ngModel)]="bookForm.any" min="1000" max="2030">
          </div>
          <div class="form-group">
            <label>Quantitat Total</label>
            <input type="number" [(ngModel)]="bookForm.quantitatTotal" min="1">
          </div>
          <div class="form-group">
            <label>Quantitat Disponible</label>
            <input type="number" [(ngModel)]="bookForm.quantitatDisponible" min="0">
          </div>
        </div>

        <div class="form-group full">
          <label>Descripci√≥</label>
          <textarea [(ngModel)]="bookForm.descripcio" rows="3" placeholder="Descripci√≥ del llibre..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeModal()" [disabled]="isSaving">Cancel¬∑lar</button>
        <button class="btn-save" (click)="saveBook()" [disabled]="isSaving">
          {{ isSaving ? 'Guardant...' : (editingBook ? 'Actualitzar' : 'Crear') }}
        </button>
      </div>
    </div>
  </div>
</div>
