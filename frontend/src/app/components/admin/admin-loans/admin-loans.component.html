<div class="admin-container">
  <div class="admin-header">
    <div class="header-content">
      <button class="btn-back" (click)="goBack()">â† Tornar</button>
      <h1>ğŸ“‹ GestiÃ³ de PrÃ©stecs</h1>
      <div class="stats">
        <span class="stat active">{{ activeCount }} actius</span>
        <span class="stat returned">{{ returnedCount }} retornats</span>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="toast success">âœ“ {{ successMessage }}</div>
  <div *ngIf="errorMessage" class="toast error">âœ• {{ errorMessage }}</div>

  <div class="content">
    <!-- Filters -->
    <div class="filters-bar">
      <input type="text" [(ngModel)]="searchTerm" placeholder="ğŸ” Cercar per usuari o llibre...">
      <select [(ngModel)]="filterStatus">
        <option value="all">Tots els prÃ©stecs</option>
        <option value="ACTIU">NomÃ©s actius</option>
        <option value="RETORNAT">NomÃ©s retornats</option>
      </select>
      <span class="count">{{ filteredLoans.length }} prÃ©stecs</span>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Carregant prÃ©stecs...</p>
    </div>

    <!-- Loans Table -->
    <div *ngIf="!loading" class="table-container">
      <table>
        <thead>
          <tr>
            <th>Usuari</th>
            <th>Llibre</th>
            <th>Data PrÃ©stec</th>
            <th>Data Retorn Prevista</th>
            <th>Data Retorn Real</th>
            <th>Estat</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of filteredLoans" [class]="getStatusClass(loan)">
            <td class="user-cell">
              <div class="user-mini">
                <span class="avatar">{{ loan.usuari?.nom?.charAt(0)?.toUpperCase() || '?' }}</span>
                <div>
                  <strong>{{ loan.usuari?.nom || 'Usuari desconegut' }}</strong>
                  <small>{{ loan.usuari?.email }}</small>
                </div>
              </div>
            </td>
            <td class="book-cell">
              <strong>{{ loan.llibre?.titol || 'Llibre desconegut' }}</strong>
              <small>{{ loan.llibre?.autor }}</small>
            </td>
            <td>{{ loan.dataPrestec | date: 'dd/MM/yyyy' }}</td>
            <td>{{ loan.dataRetornaPrevista | date: 'dd/MM/yyyy' }}</td>
            <td>{{ loan.dataRetornaReal ? (loan.dataRetornaReal | date: 'dd/MM/yyyy') : '-' }}</td>
            <td>
              <span class="status-badge" [class]="getStatusClass(loan)">
                <span *ngIf="isOverdue(loan)">âš ï¸ Endarrerit</span>
                <span *ngIf="!isOverdue(loan) && loan.estat === 'ACTIU'">ğŸ“– Actiu</span>
                <span *ngIf="loan.estat === 'RETORNAT'">âœ… Retornat</span>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="filteredLoans.length === 0" class="no-results">
        No s'han trobat prÃ©stecs
      </div>
    </div>
  </div>
</div>
