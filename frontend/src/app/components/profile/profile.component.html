<div class="profile-container">
  <!-- Header amb gradient -->
  <div class="profile-header">
    <div class="header-content">
      <button class="btn-back" (click)="goHome()">
        <span class="back-icon">â†</span> Tornar
      </button>
      <h1>El Meu Perfil</h1>
      <div class="role-badge" [class.admin]="isAdmin()">
        {{ isAdmin() ? 'ğŸ‘‘ Administrador' : 'ğŸ‘¤ Usuari' }}
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Carregant perfil...</p>
  </div>

  <div *ngIf="!loading" class="profile-content">
    <!-- Missatges -->
    <div *ngIf="successMessage" class="toast success">
      <span class="toast-icon">âœ“</span>
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="toast error">
      <span class="toast-icon">âœ•</span>
      {{ errorMessage }}
    </div>

    <!-- Targeta Principal del Perfil -->
    <div class="main-card">
      <div class="avatar-section">
        <div class="avatar-wrapper">
          <div class="avatar-circle">{{ getInitial() }}</div>
          <div class="avatar-status" [class.online]="true"></div>
        </div>
        <h2 class="user-name">{{ user.nom }}</h2>
        <p class="user-email">{{ user.email }}</p>
      </div>

      <!-- InformaciÃ³ Personal -->
      <div class="info-section">
        <h3 class="section-title">
          <span class="section-icon">ğŸ“‹</span>
          InformaciÃ³ Personal
        </h3>
        
        <div class="info-grid">
          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ‘¤</span>
              Nom Complet
            </div>
            <div *ngIf="!editMode" class="info-value">{{ user.nom }}</div>
            <input
              *ngIf="editMode"
              type="text"
              [(ngModel)]="editedUser.nom"
              class="edit-input"
              [class.invalid]="!editedUser.nom?.trim()"
              placeholder="El nom Ã©s obligatori"
            />
            <span *ngIf="editMode && !editedUser.nom?.trim()" class="field-error">Camp obligatori</span>
          </div>

          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ“§</span>
              Correu ElectrÃ²nic
            </div>
            <div *ngIf="!editMode" class="info-value">{{ user.email }}</div>
            <input
              *ngIf="editMode"
              type="email"
              [(ngModel)]="editedUser.email"
              class="edit-input"
              [class.invalid]="!editedUser.email?.trim()"
              placeholder="L'email Ã©s obligatori"
            />
            <span *ngIf="editMode && !editedUser.email?.trim()" class="field-error">Camp obligatori</span>
          </div>

          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ“±</span>
              TelÃ¨fon
            </div>
            <div *ngIf="!editMode" class="info-value">{{ user.telefon || 'No indicat' }}</div>
            <input
              *ngIf="editMode"
              type="text"
              [(ngModel)]="editedUser.telefon"
              class="edit-input"
              placeholder="TelÃ¨fon (opcional)"
            />
          </div>

          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ </span>
              AdreÃ§a
            </div>
            <div *ngIf="!editMode" class="info-value">{{ user.adreca || 'No indicada' }}</div>
            <input
              *ngIf="editMode"
              type="text"
              [(ngModel)]="editedUser.adreca"
              class="edit-input"
              placeholder="AdreÃ§a (opcional)"
            />
          </div>

          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ“…</span>
              Membre des de
            </div>
            <div class="info-value">{{ user.createdAt | date: 'dd MMMM yyyy' }}</div>
          </div>

          <div class="info-card">
            <div class="info-label">
              <span class="label-icon">ğŸ”</span>
              Tipus de Compte
            </div>
            <div class="info-value role-value" [class.admin]="isAdmin()">
              {{ isAdmin() ? 'Administrador' : 'Usuari EstÃ ndard' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Accions del Perfil -->
      <div class="actions-section">
        <h3 class="section-title">
          <span class="section-icon">âš™ï¸</span>
          Accions del Compte
        </h3>
        
        <div class="actions-grid">
          <button
            *ngIf="!editMode"
            class="action-btn primary"
            (click)="toggleEditMode()"
          >
            <span class="btn-icon">âœï¸</span>
            Editar Perfil
          </button>

          <div *ngIf="editMode" class="edit-actions">
            <button
              class="action-btn success"
              (click)="saveProfile()"
              [disabled]="isSaving || !canSave()"
            >
              <span class="btn-icon">ğŸ’¾</span>
              {{ isSaving ? 'Guardant...' : 'Guardar' }}
            </button>
            <button
              class="action-btn secondary"
              (click)="toggleEditMode()"
              [disabled]="isSaving"
            >
              <span class="btn-icon">â†©ï¸</span>
              CancelÂ·lar
            </button>
          </div>

          <button *ngIf="!editMode" class="action-btn warning" (click)="changePassword()">
            <span class="btn-icon">ğŸ”‘</span>
            Canviar Contrasenya
          </button>

          <button *ngIf="!editMode && !isAdmin()" class="action-btn danger" (click)="deleteAccount()">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            Eliminar Compte
          </button>
        </div>
      </div>
    </div>

    <!-- SecciÃ³ Admin -->
    <div *ngIf="isAdmin()" class="admin-section">
      <div class="admin-card">
        <div class="admin-header">
          <h3>
            <span class="admin-icon">ğŸ‘‘</span>
            Panel d'Administrador
          </h3>
          <p>AccÃ©s exclusiu per gestionar Bookio.net</p>
        </div>
        
        <div class="admin-stats">
          <div class="stat-item">
            <span class="stat-number">{{ totalUsers }}</span>
            <span class="stat-label">Usuaris</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ totalBooks }}</span>
            <span class="stat-label">Llibres</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ totalLoans }}</span>
            <span class="stat-label">PrÃ©stecs Actius</span>
          </div>
        </div>

        <div class="admin-actions">
          <button class="admin-btn" (click)="goToManageBooks()">
            <span class="admin-btn-icon">ğŸ“š</span>
            <span class="admin-btn-text">Gestionar Llibres</span>
            <span class="admin-btn-desc">Afegir, editar o eliminar llibres</span>
          </button>
          
          <button class="admin-btn" (click)="goToManageLoans()">
            <span class="admin-btn-icon">ğŸ“‹</span>
            <span class="admin-btn-text">Gestionar PrÃ©stecs</span>
            <span class="admin-btn-desc">Veure tots els prÃ©stecs</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
